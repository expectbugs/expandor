# Expandor Master Default Configuration
# This file consolidates ALL configuration values in the system
# NO HARDCODED VALUES should exist in the code
# This replaces all individual config files

version: "2.0"  # Master configuration version

# Core configuration settings
core:
  default_strategy: "auto"  # Default expansion strategy when not specified

# Quality presets define complete parameter sets
quality_presets:
  custom:
    name: "Custom Settings"
    description: "Base default values - used when no preset selected"
    priority: 0
    
    generation:
      num_inference_steps: 30
      guidance_scale: 7.5
      scheduler: "EulerAncestralDiscreteScheduler"
      use_karras_sigmas: false
      
    resolution:
      prefer_native: true
      upscale_method: "real-esrgan"
      upscale_denoise: 0.2
      
    expansion:
      denoising_strength: 0.7
      mask_blur_ratio: 0.4
      overlap_ratio: 0.7
      edge_blend_pixels: 96
      
    validation:
      enable_artifact_detection: true
      artifact_threshold: 0.1
      enable_seam_detection: true
      seam_threshold: 0.1
      max_repair_attempts: 3
      
    performance:
      enable_xformers: true
      enable_cpu_offload: false
      tile_processing: false
      batch_size: 1
      
    models:
      prefer_refiner: false
      refiner_strength: 0.3
      controlnet_strength: 0.25
      
    output:
      format: "png"
      compression: 0
      save_intermediate: false
      
    json:
      indent: 2
      sort_keys: false
      ensure_ascii: false
      
  ultra:
    name: "Ultra Quality"
    description: "Highest quality with maximum processing time"
    priority: 4
    
    generation:
      num_inference_steps: 50
      guidance_scale: 8.0
      scheduler: "EulerAncestralDiscreteScheduler"
      use_karras_sigmas: true
      
    resolution:
      prefer_native: true
      upscale_method: "real-esrgan"
      upscale_denoise: 0.2
      
    expansion:
      denoising_strength: 0.70
      mask_blur_ratio: 0.5
      overlap_ratio: 0.85
      edge_blend_pixels: 128
      
    validation:
      enable_artifact_detection: true
      artifact_threshold: 0.1
      enable_seam_detection: true
      seam_threshold: 0.05
      max_repair_attempts: 5
      
    performance:
      enable_xformers: true
      enable_cpu_offload: false
      tile_processing: false
      batch_size: 1
      
    models:
      prefer_refiner: true
      refiner_strength: 0.3
      controlnet_strength: 0.25
      
    output:
      format: "png"
      compression: 0
      save_intermediate: true
      
    json:
      indent: 2
      sort_keys: false
      ensure_ascii: false
      
  high:
    name: "High Quality"
    description: "Excellent quality with good performance balance"
    priority: 3
    
    generation:
      num_inference_steps: 50
      guidance_scale: 7.5
      scheduler: "EulerAncestralDiscreteScheduler"
      use_karras_sigmas: true
      
    resolution:
      prefer_native: true
      upscale_method: "real-esrgan"
      upscale_denoise: 0.3
      
    expansion:
      denoising_strength: 0.65
      mask_blur_ratio: 0.4
      overlap_ratio: 0.75
      edge_blend_pixels: 96
      
    validation:
      enable_artifact_detection: true
      artifact_threshold: 0.2
      enable_seam_detection: true
      seam_threshold: 0.1
      max_repair_attempts: 3
      
    performance:
      enable_xformers: true
      enable_cpu_offload: false
      tile_processing: false
      batch_size: 1
      
    models:
      prefer_refiner: true
      refiner_strength: 0.25
      controlnet_strength: 0.35
      
    output:
      format: "png"
      compression: 3
      save_intermediate: false
      
    json:
      indent: 2
      sort_keys: false
      ensure_ascii: false
      
  balanced:
    name: "Balanced Quality"
    description: "Good quality with reasonable processing time"
    priority: 2
    
    generation:
      num_inference_steps: 35
      guidance_scale: 7.0
      scheduler: "EulerDiscreteScheduler"
      use_karras_sigmas: false
      
    resolution:
      prefer_native: false
      upscale_method: "bicubic"
      upscale_denoise: 0.0
      
    expansion:
      denoising_strength: 0.60
      mask_blur_ratio: 0.35
      overlap_ratio: 0.6
      edge_blend_pixels: 64
      
    validation:
      enable_artifact_detection: true
      artifact_threshold: 0.3
      enable_seam_detection: false
      seam_threshold: 0.15
      max_repair_attempts: 2
      
    performance:
      enable_xformers: true
      enable_cpu_offload: true
      tile_processing: true
      batch_size: 2
      
    models:
      prefer_refiner: false
      refiner_strength: 0.2
      controlnet_strength: 0.5
      
    output:
      format: "png"
      compression: 6
      save_intermediate: false
      
    json:
      indent: 2
      sort_keys: false
      ensure_ascii: false
      
  fast:
    name: "Fast Processing"
    description: "Fastest processing with acceptable quality"
    priority: 1
    
    generation:
      num_inference_steps: 20
      guidance_scale: 6.0
      scheduler: "DDIMScheduler"
      use_karras_sigmas: false
      
    resolution:
      prefer_native: false
      upscale_method: "bilinear"
      upscale_denoise: 0.0
      
    expansion:
      denoising_strength: 0.65
      mask_blur_ratio: 0.25
      overlap_ratio: 0.4
      edge_blend_pixels: 32
      
    validation:
      enable_artifact_detection: false
      artifact_threshold: 0.5
      enable_seam_detection: false
      seam_threshold: 0.25
      max_repair_attempts: 0
      
    performance:
      enable_xformers: true
      enable_cpu_offload: true
      tile_processing: true
      batch_size: 4
      
    models:
      prefer_refiner: false
      refiner_strength: 0.0
      controlnet_strength: 0.5
      
    output:
      format: "jpeg"
      compression: 85
      save_intermediate: false
      
    json:
      indent: 2
      sort_keys: false
      ensure_ascii: false

# Global quality settings
quality_global:
  default_preset: "custom"
  
  auto_select:
    enabled: true
    rules:
      - condition: "resolution > 4096"
        preset: "fast"
      - condition: "aspect_ratio_change > 4"
        preset: "high"
      - condition: "vram_available < 4000"
        preset: "fast"
        
  adaptive_quality:
    enabled: true
    min_steps: 15
    max_steps: 100
    vram_scaling: true
    
  validation:
    always_validate_ultra: true
    skip_validation_on_error: false
    
  output:
    preserve_metadata: true
    optimize_filesize: false
    max_dimension: 16384

# Strategy-specific defaults
strategies:
  progressive_outpaint:
    # From progressive_outpaint.py lines 69-82
    first_step_ratio: 1.4
    middle_step_ratio: 1.25  
    final_step_ratio: 1.15
    base_mask_blur: 32
    base_steps: 60
    max_supported_ratio: 8.0
    # From strategy_parameters.yaml
    base_strength: 0.75
    min_strength: 0.35
    max_strength: 0.85
    seam_repair_multiplier: 0.4
    blur_radius_ratio: 0.4
    mask_blur_ratio: 0.05
    edge_preservation_ratio: 0.1
    # Additional parameters
    outpaint_prompt_suffix: ", seamless expansion, extended scenery, natural continuation"
    edge_sample_width: 50
    # Aspect ratio thresholds
    aspect_ratio_thresholds:
      minimal: 0.1
      moderate: 0.3
      significant: 1.0
      extreme: 4.0
    # Analysis thresholds
    color_variance_uniform_threshold: 20
    monochrome_threshold: 10
    brightness_dark_threshold: 0.3
    brightness_bright_threshold: 0.7
    contrast_high_threshold: 0.3
    edge_density_detailed_threshold: 20
    # Step multipliers
    first_step_multiplier: 1.2
    final_step_multiplier: 0.8
    # Strength adjustments
    high_complexity_multiplier: 1.1
    low_complexity_multiplier: 0.8
    large_expansion_ratio_threshold: 2.0
    large_expansion_strength_limit: 0.8
    # Seam repair
    min_seam_width: 64
    seam_blur_divisor: 2
    seam_repair_strength: 0.3
    seam_repair_steps: 30
    seam_repair_guidance: 5.0
    seam_repair_max_strength: 0.3  # Maximum strength for seam repair
    # Blur calculations
    mask_blur_multiplier: 2
    # Config defaults (temporary until Phase 4)
    default_denoising_strength: 0.75
    default_num_inference_steps: 50
    default_guidance_scale: 7.5
    
  tiled_expansion:
    # From tiled_expansion.py lines 50-55
    default_tile_size: 1024
    overlap: 256
    blend_width: 256
    # From strategy_parameters.yaml
    vram_safety_ratio: 0.7
    refinement_strength: 0.15
    edge_fix_strength: 0.25
    final_pass_strength: 0.35
    min_tile_size: 512
    max_tile_size: 1536
    tile_overlap: 48
    overlap_ratio: 0.25
    blend_method: "mixture_of_diffusers"
    progressive_strength_reduction: true
    max_tiles_before_reduction: 50
    refinement_guidance: 6.5
    refinement_steps: 20
    edge_fix_guidance: 7.0
    edge_fix_steps: 30
    final_pass_guidance: 7.0
    final_pass_steps: 40
    # Tile calculations
    min_edge_size_divisor: 2
    blend_size_divisor: 2
    division_epsilon: 1e-8
    # Tile size candidates (in order of preference)
    tile_size_candidates: [1536, 1024, 768]
    # Final pass mask
    final_pass_mask_value: 255

  cpu_offload:
    # From strategy_parameters.yaml
    safety_factor: 0.6
    conservative_safety_factor: 0.5
    pipeline_vram: 1024
    gpu_memory_fallback: 512
    aspect_change_threshold: 0.1
    tile_generation_strength: 0.9
    tile_generation_guidance: 7.0
    tile_refinement_strength: 0.3
    tile_refinement_guidance: 7.0
    # From cpu_offload.py (if any hardcoded)
    min_tile_size: 512
    default_tile_size: 512
    max_tile_size: 1536
    min_overlap: 64
    default_overlap: 128
    # VRAM calculations
    vram_bytes_per_pixel: 24  # 4 * 3 * 2
    vram_mb_divisor: 1048576  # 1024**2
    strategy_overhead_mb: 512
    fallback_vram_mb: 512
    # Tile calculations
    tile_size_rounding: 64
    dimension_rounding: 8
    # Aspect adjustment
    aspect_adjust_steps: 3
    # Mask values
    mask_background_value: 0
    mask_foreground_value: 255
    # Generation steps
    tile_generation_steps: 25
    tile_refinement_steps: 20

  swpo:
    # From strategy_parameters.yaml
    default_overlap_ratio: 0.8
    default_denoising_strength: 0.75
    unification_strength: 0.15
    window_blur_radius: 30
    edge_blur_ratio: 0.1
    unification_guidance: 7.0
    unification_steps: 30
    # From swpo_strategy.py (if any hardcoded)
    default_window_size: 200
    min_window_size: 128
    max_window_size: 512
    default_edge_blur_width: 50
    clear_cache_every_n_windows: 5
    # Step calculation thresholds and values
    step_thresholds:
      small: 100
      medium: 300
      large: 500
    step_values:
      small: 50
      medium: 60
      large: 70
      xlarge: 80
    # Guidance scale calculation thresholds and values
    guidance_thresholds:
      small: 100
      medium: 300
      large: 500
    guidance_values:
      small: 6.5
      medium: 7.0
      large: 7.5
      xlarge: 8.0
    # Window strength multipliers
    first_window_strength_multiplier: 1.05
    first_window_strength_max: 0.85
    last_window_strength_multiplier: 0.9
    last_window_strength_min: 0.6
    middle_window_strength_max: 0.75
    overlap_ratio_threshold: 0.5
    overlap_strength_multiplier: 0.95
    # Source context analysis
    kernel_size: 20
    texture_variance_high_threshold: 500
    texture_variance_smooth_threshold: 100
    default_edge_color: [128, 128, 128]
    # Differential mask parameters
    differential_mask_max_dist: 100
    differential_mask_distance_thresholds:
      near: 20
      medium: 40
    differential_mask_opacity_values:
      high_blend: 0.78  # ~200/255
      very_high_blend: 0.9  # ~230/255
      full_generation: 1.0
    # Mask threshold values
    mask_binary_threshold: 128
    mask_preserve_threshold: 0.1
    mask_generate_threshold: 0.9
    # Blur calculations
    blur_radius_min_percentage: 0.4
    edge_blur_radius_fallback: 50
    # VRAM calculation constants
    vram_channels: 3
    vram_bytes_per_channel: 4
    vram_batch_size: 1
    vram_safety_multiplier: 2.5
    vram_mb_divisor: 1048576  # 1024**2
    # Gradient and blur settings
    gradient_size_divisor: 2
    gradient_size_max: 100
    gradient_blur_divisor: 4
    # Noise settings
    mask_noise_strength: 0.02
    # Seed offset for unification pass
    unification_seed_offset: 9999
    # Edge analysis
    edge_width: 10
    # Dimension rounding
    dimension_multiple: 8
    # Mask conversion
    mask_conversion_divisor: 255.0
    # Noise array bounds
    noise_min_value: 0
    noise_max_value: 255

  direct_upscale:
    # From strategy_parameters.yaml
    vram_thresholds:
      high: 8000
      medium: 6000
      low: 4000
    scale_thresholds:
      low: 2.0
      medium: 3.0
    # Upscaler configuration
    default_model: "RealESRGAN_x4plus"
    default_tile_size: 0  # 0 means auto
    default_tile_pad: 10
    # Model scales
    model_scales:
      RealESRGAN_x4plus: 4
      RealESRGAN_x2plus: 2
    # Model selection for different scenarios
    model_selection:
      fast: "RealESRGAN_x2plus"
      default: "RealESRGAN_x4plus"
    # Upscale settings
    use_fp32: true  # Whether to use FP32 precision
    # Tile sizes for different VRAM levels
    tile_sizes:
      high_vram: 2048
      medium_vram: 1024
      low_vram: 512
    # ESRGan scale factors for different scale levels
    esrgan_scales:
      low: 2
      medium: 3
      high: 4
    # Initial values
    initial_passes: 1
    initial_scale: 1.0
    initial_pass_num: 0
    # Timestamp multiplier
    timestamp_multiplier: 1000

  controlnet_progressive:
    # From strategy_parameters.yaml
    default_strength: 0.25
    conditioning_scale: 0.5
    control_guidance_start: 0.0
    control_guidance_end: 1.0
    # From controlnet_progressive.py
    vram_priority: 4
    canvas_centering_divisor: 2
    canvas_background_color: "white"
    mask_inpaint_value: 255  # White = inpaint
    mask_keep_value: 0  # Black = keep
    strength_fallback: 0.95
    control_types_requiring_extraction: ["canny", "blur", "depth", "normal"]

  hybrid_adaptive:
    # Required parameters
    aspect_ratio_threshold: 1.5
    extreme_ratio_threshold: 3.0
    vram_safety_factor: 0.8
    # Decision thresholds
    simple_aspect_change_threshold: 0.1
    simple_scale_difference_threshold: 0.1
    additional_upscale_threshold: 1.1  # 10% scaling

# Processor-specific defaults
processors:
  artifact_detector:
    # From quality_thresholds.yaml (if exists) or code
    seam_threshold: 0.25
    color_threshold: 30
    gradient_threshold: 0.25
    frequency_threshold: 0.35
    texture_threshold: 0.15
    min_quality_score: 0.75
    edge_sensitivity: 0.8
    gradient_deviation_allowed: 0.1
    enabled_checks:
      - seam
      - color
      - gradient
      - frequency
      - texture
    weights:
      seam: 0.3
      color: 0.2
      gradient: 0.2
      frequency: 0.2
      texture: 0.1
    # Enhanced artifact detector specific
    skip_validation_score: 1.0
    artifact_percentage_multiplier: 100
    orientation_vertical: 1.5707963267948966  # np.pi / 2
    critical_severity_threshold: 5.0
    color_sample_window: 5
    color_normalization_divisor: 255.0
    boundary_sample_width: 2
    fft_magnitude_offset: 1
    center_divisor: 2
    frequency_window_divisor: 4
    high_freq_epsilon: 1e-6
    frequency_score_max: 1.0
    pattern_shifts: [64, 128, 256]
    pattern_shift_min_divisor: 2
    expected_diff_divisor: 255
    pattern_score_divisor: 255.0
    pattern_score_fallback: 0.0
    quality_preset_multipliers:
      ultra: 0.5
      high: 0.7
      balanced: 1.0
      fast: 1.5
    score_weights:
      color: 0.3
      gradient: 0.3
      frequency: 0.2
      pattern: 0.2
    seam_penalty_multiplier: 0.2
    seam_penalty_max: 1.0
    severity_thresholds:
      none_max: 0.1
      low_max: 0.3
      medium_max: 0.5
      high_max: 0.7
    artifact_mask_dilation: 10
    boundary_mask_width: 5
    detection_score_threshold: 0.5
    denoising_strength_recommendation: 0.9

  artifact_removal:
    # Detection resolution and scaling
    max_detection_resolution: 4096
    scale_min: 1.0
    
    # Boundary detection parameters
    boundary_margin: 10
    color_sample_region_size: 20
    color_difference_threshold: 10
    color_diff_norm_divisor: 50
    boundary_mask_width: 5
    
    # Detection weights for combined mask
    color_detection_weight: 0.4
    gradient_detection_weight: 0.3
    frequency_detection_weight: 0.3
    combined_mask_threshold: 0.1
    
    # Gradient detection parameters
    gradient_boundary_check_width: 2
    gradient_spike_multiplier: 2
    gradient_mask_value: 0.8
    gradient_mask_width: 5
    
    # Frequency detection parameters
    frequency_location_scale: 0.1
    magnitude_spectrum_multiplier: 1.5
    frequency_mask_width: 10
    frequency_mask_value: 0.5
    fft_epsilon: 1
    
    # Tile detection parameters
    tile_boundary_width: 3
    tile_mask_value: 0.6
    
    # Discontinuity detection (Canny/Hough)
    canny_threshold_low: 50
    canny_threshold_high: 150
    hough_rho: 1
    hough_theta_divisor: 180  # np.pi / 180
    hough_threshold: 100
    hough_min_line_length: 100
    hough_max_line_gap: 10
    hough_line_thickness: 5
    hough_line_mask_value: 0.4

  edge_analysis:
    # Detection thresholds from config
    edge_detection_sensitivity: 0.1
    seam_detection_sensitivity: 0.3
    artifact_detection_sensitivity: 0.5
    edge_threshold_hough: 100
    
    # Edge detection parameters
    canny_low_threshold: 50
    canny_high_threshold: 150
    edge_normalization_divisor: 255.0
    
    # Boundary analysis
    boundary_check_width: 5
    boundary_position_offset: 2
    vertical_orientation: 1.5707963267948966  # np.pi / 2
    horizontal_orientation: 0
    
    # Hough line detection
    hough_rho: 1
    hough_theta_divisor: 180  # np.pi / 180
    min_line_length_divisor: 4  # minLineLength = min(width, height) // 4
    max_line_gap: 10
    
    # Artifact detection
    suspicious_line_length_ratio: 0.3
    angle_tolerance_degrees: 5
    straight_angle_threshold: 175
    right_angle: 90
    artifact_edge_strength: 0.8
    artifact_confidence: 0.7
    
    # Pattern detection
    pattern_box_size: 64
    pattern_step_size: 32
    pattern_variance_threshold: 100
    pattern_edge_strength: 0.5
    pattern_confidence: 0.5
    
    # Quality score calculation
    perfect_quality_score: 1.0
    seam_impact_multiplier: 0.2
    artifact_impact_multiplier: 0.1
    normalization_pixels: 1000000  # 1MP
    quality_score_min: 0.0
    quality_score_max: 1.0
    
    # Color discontinuity detection
    color_sample_width: 5
    default_color_threshold: 30.0
    
    # Edge mask creation
    seam_thickness_multiplier: 2

  boundary_analysis:
    # Initial values
    initial_quality_score: 1.0
    min_quality_score: 0.0
    
    # Quality score penalties
    critical_penalty: 0.2
    high_penalty: 0.1
    medium_penalty: 0.05
    
    # Analysis parameters
    boundary_margin: 10
    strip_width: 5
    
    # Severity thresholds for color/texture differences
    color_diff_thresholds:
      high: 40
      medium: 20
      low: 10
    texture_diff_thresholds:
      high: 30
      medium: 15
      low: 7
    
    # Severity map values
    severity_values:
      low: 0.3
      medium: 0.6
      high: 0.9
      critical: 1.0
      default: 0.5
    
    # Gradient falloff
    gradient_falloff_distance: 10
    
    # Recommendation thresholds
    max_issues_before_strategy_recommendation: 5
    avg_color_diff_ultra_threshold: 25
    
    # Visualization
    rgb_max_value: 255
    severity_color_thresholds:
      green_max: 0.3
      yellow_max: 0.6
    severity_colors:
      green: [0, 255, 0]
      yellow: [255, 255, 0]
      red: [255, 0, 0]
    
    # Legacy values (for backwards compatibility if needed)
    edge_sample_size: 50
    color_similarity_threshold: 0.9
    pattern_match_threshold: 0.8

  seam_repair:
    # Mask processing
    mask_expansion_pixels: 10
    mask_blur_radius: 5
    blend_mask_expansion: 20
    smooth_blend_expansion: 15
    blend_mask_blur_radius: 10
    final_blur_radius: 3
    
    # Repair parameters - required by _get_config calls
    seam_repair_strength: 0.9
    seam_repair_guidance: 7.5
    seam_repair_steps: 30
    
    # Refiner parameters
    base_blur_strength: 0.3
    artifact_repair_strength: 0.7
    artifact_repair_guidance: 7.0
    artifact_repair_steps: 25
    
    # Img2img parameters
    final_blend_strength: 0.5
    final_blend_guidance: 6.5
    final_blend_steps: 20
    
    # Image processing
    png_compress_level: 0
    mask_conversion_max: 255
    rgb_channels: 3
    
    # Thresholds
    mask_binary_threshold: 0.5
    seam_identification_threshold: 0.1
    
    # Filtering parameters
    median_filter_size: 5
    
    # Mask expansion calculation
    expansion_multiplier: 2
    expansion_offset: 1
    
    # Smooth mask defaults
    default_smooth_sigma: 5.0
    default_expand_pixels: 10

  controlnet_extractors:
    # Canny edge detection defaults
    canny:
      default_low_threshold: 100
      default_high_threshold: 200
      low_threshold_min: 0
      low_threshold_max: 255
      high_threshold_min: 0
      high_threshold_max: 255
      kernel_size: 3
      dilation_iterations: 1
    
    # Blur extraction defaults
    blur:
      valid_types: ["gaussian", "box", "motion"]
      default_radius: 5
      motion_kernel_multiplier: 2
      motion_kernel_offset: 1
    
    # Depth extraction defaults
    depth:
      model_id: "Intel/dpt-large"
      normalize: true
      invert: false
    
    # Resampling configuration
    resampling:
      method: "LANCZOS"
    
    # Additional parameters referenced in code
    motion_blur_min_radius: 2
    depth_blur_radius: 20
    
    # RGB channels
    rgb_channels: 3
    
    # Inversion value
    invert_max_value: 255

  tiled_processor:
    # Default tile processing parameters
    default_tile_size: 512
    default_overlap: 64
    min_tile_size: 256
    default_blend_mode: "gaussian"
    
    # Alpha blending values
    alpha_max: 255
    alpha_min: 0
    
    # Debug visualization
    debug_colors:
      - [255, 0, 0]      # Red
      - [0, 255, 0]      # Green
      - [0, 0, 255]      # Blue
      - [255, 255, 0]    # Yellow
      - [255, 0, 255]    # Magenta
      - [0, 255, 255]    # Cyan
    debug_background_color: [255, 255, 255]  # White
    debug_boundary_width: 2
    debug_content_width: 1
    debug_text_offset: 5

  quality_orchestrator:
    # Quality thresholds
    quality_threshold: 0.85
    max_refinement_passes: 3
    auto_fix_threshold: 0.7
    
    # Initial values
    initial_quality_score: 0.0
    default_quality_score: 1.0
    quality_score_min: 0.0
    quality_score_max: 1.0
    
    # Boundary conversion defaults
    default_denoising_strength: 0.9
    default_step: 0
    
    # Severity penalties for quality scoring
    severity_penalties:
      none: 0.0
      low: 0.05
      medium: 0.15
      high: 0.30
      critical: 0.50
    default_severity_penalty: 0.2
    
    # Method score penalty multiplier
    method_score_penalty_multiplier: 0.1

  quality_validator:
    # From quality validation
    min_quality_score: 0.7
    max_retries: 3
    retry_delay: 1.0
    
    # Quality score calculation
    initial_score: 1.0
    score_min: 0.0
    score_max: 1.0
    
    # Seam penalties
    seam_penalty_per_seam: 0.1
    seam_penalty_max_reduction: 0.5
    
    # Severity penalties
    severity_penalties:
      critical: 0.3
      high: 0.2
      medium: 0.1
      low: 0.05
      none: 0.0
    
    # Mask coverage penalty
    mask_coverage_multiplier: 0.3
    mask_coverage_max_reduction: 0.3

  smart_refiner:
    # Default initialization parameters
    default_max_iterations: 3
    default_quality_threshold: 0.85
    
    # Refinement parameters
    base_strength: 0.4
    strength_multiplier: 1.5
    min_region_size: 32
    
    # Blur radii for different boundaries
    large_boundary_blur: 32
    medium_boundary_blur: 16
    small_boundary_blur: 24
    
    # Refinement pipeline parameters
    refinement_steps: 30
    refinement_guidance: 7.5
    
    # Path configuration - removed, use paths.temp_dir instead
    
    # Region expansion
    region_expansion_divisor: 2
    
    # Maximum strength limits by artifact type
    max_strength_seam: 0.9
    max_strength_pattern: 0.7
    max_strength_other: 0.6
    
    # Mask creation
    mask_initial_value: 0
    mask_fill_value: 255
    inner_margin_divisor: 2
    
    # Percentage calculation
    percentage_multiplier: 100

# VRAM strategy configuration
vram_strategies:
  fallback_chain:
    1: "tiled_large"
    2: "tiled_medium"
    3: "tiled_small"
    4: "cpu_offload"

# VRAM management defaults
vram:
  thresholds:
    tiled_processing: 4000
    minimum: 2000
    critical: 1000
  buffer_mb: 512
  safety_factor: 0.9
  measurement_retries: 3
  measurement_delay: 0.5
  # Image calculation parameters
  image_channels: 3  # RGB channels
  bytes_per_pixel: 4  # 32-bit float per channel
  default_batch_size: 1  # Single image processing
  estimation_safety_factor: 2.5  # Conservative VRAM estimation
  # Dimension constraints for VRAM calculations
  min_dimension_size: 384  # Minimum safe dimension for processing
  max_dimension_size: 2048  # Maximum dimension for single pass
  model_requirements:
    sd15: 4000
    sd2: 6000
    sdxl: 10000
    sd3: 16000
    flux: 24000
    default: 8000
  operation_multipliers:
    generate: 1.0
    img2img: 1.2
    inpaint: 1.5
    upscale: 0.8
    default: 1.0
  pixel_overhead_mb_per_megapixel: 4
  estimation_safety_margin: 1.2
  # Model-specific memory requirements (MB per megapixel)
  model_memory_per_megapixel:
    sdxl: 150  # ~150MB per megapixel for SDXL
    sd15: 100  # ~100MB per megapixel for SD 1.5
    sd2: 120   # ~120MB per megapixel for SD 2.x
    flux: 200  # ~200MB per megapixel for Flux
    unknown: 150  # Default for unknown models
  # Tiling parameters for memory-constrained processing
  tile_size_step: 256  # Step size for tile size reduction when VRAM limited
  min_overlap: 128  # Minimum overlap between tiles for proper blending
  attention_multiplier: 4  # Transformer architecture memory requirement multiplier
  memory_profiles:
    low:  # Less than 4GB
      threshold_mb: 4000
      settings:
        enable_attention_slicing: true
        enable_vae_slicing: true
        enable_cpu_offload: true
        sequential_cpu_offload: true
        batch_size: 1
        tile_size: 512
    medium:  # 4GB to 8GB
      threshold_mb: 8000
      settings:
        enable_attention_slicing: true
        enable_vae_slicing: true
        enable_cpu_offload: false
        batch_size: 1
        tile_size: 768
    high:  # 8GB or more
      settings:
        enable_attention_slicing: false
        enable_vae_slicing: false
        enable_cpu_offload: false
        batch_size: 2
        tile_size: 1024

# Model constraints
models:
  sdxl:
    min_resolution: 1024
    max_resolution: 4096
    optimal_resolution: 1344
    resolution_step: 8
  sd15:
    min_resolution: 512
    max_resolution: 2048
    optimal_resolution: 768
    resolution_step: 8

# Path configuration
paths:
  cache_dir: "~/.cache/expandor"
  output_dir: "./output"
  temp_dir: "/tmp/expandor"
  log_dir: "~/.local/share/expandor/logs"
  config_dir: "~/.config/expandor"
  # Binary paths for external tools
  binary_dir: "~/bin"
  realesrgan_path: null  # Auto-detect if null

# Output quality settings
output:
  default_format: "png"  # Default output format when not specified
  default_extension: ".png"  # Default file extension when not specified
  formats:
    png:
      compression: 0
      optimize: false
    jpeg:
      quality: 95
      optimize: true
      progressive: true
    webp:
      quality: 95
      lossless: false
      method: 6
  metadata:
    save_generation_params: true
    save_expandor_version: true
    save_timestamp: true

# Processing parameters
processing:
  max_threads: 4
  batch_size: 1
  enable_progress_bar: true
  verbose_logging: false
  save_intermediate_stages: false
  stage_format: "png"
  dimension_rounding: 8  # Round dimensions to multiples of this value (SDXL requirement)
  # Image processing constants
  rgb_max_value: 255.0  # Standard 8-bit RGB maximum value
  rgb_channels: 3  # Number of color channels in RGB
  # Temp file cleanup patterns
  temp_cleanup_patterns:
    - "progressive/*.png"
    - "tiles/*.png"
    - "upscale/*.png"
    - "masks/*.png"

# Adapter default parameters
adapters:
  # Common defaults for all adapters
  common:
    default_width: 1024
    default_height: 1024
    default_num_inference_steps: 50
    default_guidance_scale: 7.5
    default_strength: 0.8
    default_negative_prompt: null
    default_seed: null
    default_scale_factor: 2
    
  # Diffusers-specific defaults
  diffusers:
    default_device: "cuda"
    default_torch_dtype: "float16"
    default_variant: "fp16"
    default_use_safetensors: true
    default_enable_xformers: true
    lora_default_weight: 1.0
    controlnet_default_conditioning_scale: 1.0
    
  # A1111-specific defaults
  a1111:
    api_endpoint: "http://localhost:7860"
    default_sampler: "Euler a"
    default_cfg_scale: 7.5
    default_steps: 50
    default_width: 1024
    default_height: 1024
    default_denoising_strength: 0.8
    min_dimension: 512
    dimension_multiple: 64
    # VRAM estimates for operations (in MB)
    vram_estimates:
      generate: 4500
      inpaint: 4000
      img2img: 3500
      enhance: 2000
      default: 4000
    
  # ComfyUI-specific defaults
  comfyui:
    api_endpoint: "http://localhost:8188"
    default_checkpoint: null
    default_sampler: "euler"
    default_scheduler: "normal"
    default_steps: 50
    default_cfg: 7.5
    default_denoise: 0.8
    default_width: 1024
    default_height: 1024
    min_dimension: 512
    dimension_multiple: 8
    default_vram_estimate: 4000

# Image processing parameters (from processing_params.yaml)
image_processing:
  # Artifact detection parameters
  artifact_detection:
    min_quality_score: 0.75
    seam_threshold: 0.25
    color_threshold: 30
    gradient_threshold: 0.25
    frequency_threshold: 0.35
    gradient_deviation_allowed: 0.1
    severe_artifact_penalty: 0.2
    moderate_artifact_penalty: 0.1
    minor_artifact_penalty: 0.05
  
  # Boundary analysis
  boundary_analysis:
    visual_margin: 10
  
  # Tiled processing
  tiled_processing:
    debug_rect_width: 2
    center_rect_width: 1
  
  # Image utilities
  image_utils:
    fade_start: 0.0
    edge_sampling_width: 1
  
  # LoRA management configuration
  lora:
    base_inference_steps: 50
    max_inference_steps: 100
    type_steps:
      detail: 10
      quality: 10
      style: 5
      character: 5
      subject: 5
      artifact_removal: 15
      default: 0
    type_priority:
      detail: 1
      quality: 2
      style: 3
      character: 4
      subject: 5
      artifact_removal: 0
      default: 999
    noise_scale: 0.1
    noise_octaves: 1
    octave_frequency_base: 2
    octave_amplitude_base: 0.5
    mask_fill_color: 255
  
  # Strategy selection
  strategy_selection:
    simple_upscale_threshold: 1.5
    progressive_threshold: 4.0
    default_strategy_priority: 50
    # Strategy selector thresholds
    aspect_ratio_extreme_threshold: 2.0
    expansion_extreme_threshold: 3.0
    vram_high_threshold: 16000      # 16GB
    vram_medium_threshold: 12000    # 12GB
    vram_low_threshold: 6000        # 6GB
    vram_very_low_threshold: 4000   # 4GB
    expansion_small_threshold: 1.5
    expansion_moderate_threshold: 4.0
  
  # Dimension calculation
  dimension_calculation:
    dimension_multiple: 8
    max_expansion_per_step: 2.0
    expansion_threshold: 2.0
    initial_step_number: 2
    default_window_size: 200
    default_overlap_ratio: 0.8
  
  # Memory parameters
  memory_params:
    memory_safety_factor: 1.2
    batch_size_safety_factor: 0.8
    gradient_memory_multiplier: 2
    activation_multiplier_with_grad: 4
    activation_multiplier_no_grad: 2
    bytes_per_pixel: 12
    tile_overlap: 64
    min_tile_size: 256
    max_tile_size: 2048
  
  # VRAM management
  vram_management:
    min_dimension_size: 384
    max_dimension_size: 2048
  
  # LoRA management
  lora_management:
    default_weight: 1.0
    weight_scale_factor: 1.5